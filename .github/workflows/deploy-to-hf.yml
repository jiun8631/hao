# æ–‡ä»¶å: .github/workflows/deploy-to-hf.yml

name: Build and Deploy to Hugging Face Space (via Git)

# è§¸ç™¼æ¢ä»¶ï¼šæ¯ç•¶ main åˆ†æ”¯æœ‰æ–°çš„ push æ“ä½œæ™‚ï¼Œå°±åŸ·è¡Œæ­¤å·¥ä½œæµ
on:
  push:
    branches:
      - main # å¦‚æœä½ çš„ä¸»åˆ†æ”¯æ˜¯ masterï¼Œè«‹æ”¹æˆ master

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # ç¬¬ 1 æ­¥ï¼šç°½å‡ºä½ çš„ä»£ç¢¼ï¼ˆå’Œä¹‹å‰ä¸€æ¨£ï¼‰
      - name: Checkout repository
        uses: actions/checkout@v4 # æ›´æ–°åˆ° v4 ç‰ˆæœ¬ï¼Œæ›´ç©©å®š
        with:
          submodules: 'recursive'
          fetch-depth: 0

      # ç¬¬ 2 æ­¥ï¼šå®‰è£ä¸¦è¨­ç½® Hugo ç’°å¢ƒï¼ˆå’Œä¹‹å‰ä¸€æ¨£ï¼‰
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: 'latest'
          extended: true

      # ç¬¬ 3 æ­¥ï¼šåŸ·è¡Œ Hugo æ§‹å»ºå‘½ä»¤ï¼ˆå’Œä¹‹å‰ä¸€æ¨£ï¼‰
      - name: Build with Hugo
        run: hugo --minify

      # ç¬¬ 4 æ­¥ï¼šä½¿ç”¨ Git éƒ¨ç½²åˆ° Hugging Face Space (é€™æ˜¯æ–°çš„éƒ¨åˆ†)
      # âš ï¸ é€™æ˜¯å”¯ä¸€éœ€è¦ä½ ä¿®æ”¹çš„åœ°æ–¹ âš ï¸
      - name: Deploy to HF Space
        env:
          # å¾ GitHub Secrets è®€å– HF Token
          HF_TOKEN: ${{ secrets.HF_TOKEN }} 
          # ä½ çš„ HF ç”¨æˆ¶å
          HF_USER: "hang3976" # ğŸ‘ˆ æŠŠå®ƒæ›æˆä½ çš„ HF ç”¨æˆ¶åï¼Œä¾‹å¦‚ "hang3976"
          # ä½ çš„ HF Space å
          SPACE_NAME: "hao" # ğŸ‘ˆ æŠŠå®ƒæ›æˆä½ çš„ Space åï¼Œä¾‹å¦‚ "hao"
        run: |
          # é€²å…¥ Hugo ç”Ÿæˆçš„ public æ–‡ä»¶å¤¾
          cd public
          
          # åˆå§‹åŒ–ä¸€å€‹æ–°çš„ Git å€‰åº«
          git init
          
          # é…ç½® Git ç”¨æˆ¶ä¿¡æ¯
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          
          # æ·»åŠ é ç¨‹å€‰åº«åœ°å€ï¼Œæ ¼å¼åŒ…å«äº†ç”¨æˆ¶åå’Œå¯†é‘°ï¼Œç”¨æ–¼èªè­‰
          # hf_token æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç”¨æˆ·åï¼ŒHugging Face ä¼šè¯†åˆ«å®ƒå¹¶ä½¿ç”¨åé¢çš„å¯†ç ä½œä¸º Token
          git remote add hf_space https://hf_token:${HF_TOKEN}@huggingface.co/spaces/${HF_USER}/${SPACE_NAME}
          
          # æ·»åŠ æ‰€æœ‰æ–‡ä»¶ä¸¦æäº¤
          git add .
          git commit -m "Deploy from GitHub Action ${{ github.sha }}"
          
          # å¼·åˆ¶æ¨é€åˆ° HF Space çš„ main åˆ†æ”¯ï¼Œè¦†ç›–æ‰€æœ‰æ—§æ–‡ä»¶
          git push --force hf_space main
