# æ–‡ä»¶å: .github/workflows/deploy-to-hf.yml

name: Build and Deploy to Hugging Face Space

# è§¸ç™¼æ¢ä»¶ï¼šæ¯ç•¶ main åˆ†æ”¯æœ‰æ–°çš„ push æ“ä½œæ™‚ï¼Œå°±åŸ·è¡Œæ­¤å·¥ä½œæµ
on:
  push:
    branches:
      - main # å¦‚æœä½ çš„ä¸»åˆ†æ”¯æ˜¯ masterï¼Œè«‹æ”¹æˆ master

jobs:
  deploy-to-space:
    runs-on: ubuntu-latest # ä½¿ç”¨æœ€æ–°çš„ Ubuntu è™›æ“¬æ©Ÿä¾†åŸ·è¡Œä»»å‹™

    steps:
      # ç¬¬ 1 æ­¥ï¼šç°½å‡ºä½ çš„ä»£ç¢¼
      # é€™å€‹æ­¥é©ŸæœƒæŠŠä½ çš„ GitHub å€‰åº«ä»£ç¢¼ï¼ˆåŒ…æ‹¬ä¸»é¡Œå­æ¨¡å¡Šï¼‰ä¸‹è¼‰åˆ°è™›æ“¬æ©Ÿä¸­
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          submodules: 'recursive'  # éå¸¸é‡è¦ï¼Œç¢ºä¿èƒ½æ‹‰å– themes æ–‡ä»¶å¤¾è£¡çš„ä¸»é¡Œ
          fetch-depth: 0         # æ‹‰å–æ‰€æœ‰ git æ­·å²ï¼ŒHugo å¯èƒ½éœ€è¦å®ƒä¾†ç²å–æäº¤æ—¥æœŸç­‰ä¿¡æ¯

      # ç¬¬ 2 æ­¥ï¼šå®‰è£ä¸¦è¨­ç½® Hugo ç’°å¢ƒ
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: 'latest' # ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Hugo
          extended: true         # å®‰è£æ“´å±•ç‰ˆï¼Œå¾ˆå¤šä¸»é¡Œéœ€è¦ SASS/SCSS æ”¯æŒ

      # ç¬¬ 3 æ­¥ï¼šåŸ·è¡Œ Hugo æ§‹å»ºå‘½ä»¤
      # é€™ä¸€æ­¥æœƒç”Ÿæˆä¸€å€‹ `public` æ–‡ä»¶å¤¾ï¼Œè£¡é¢æ˜¯å®Œæ•´çš„éœæ…‹ç¶²ç«™æ–‡ä»¶
      - name: Build with Hugo
        run: hugo --minify # --minify æ˜¯å¯é¸é …ï¼Œå¯ä»¥å£“ç¸® HTML/CSS/JSï¼Œè®“ç¶²ç«™æ›´å¿«

      # ç¬¬ 4 æ­¥ï¼šå°‡æ§‹å»ºå¥½çš„ `public` æ–‡ä»¶å¤¾éƒ¨ç½²åˆ° Hugging Face Space
      # âš ï¸ é€™æ˜¯å”¯ä¸€éœ€è¦ä½ ä¿®æ”¹çš„åœ°æ–¹ âš ï¸
      - name: Deploy to Hugging Face Space
        uses: crazy-max/ghaction-huggingface-space-sync@v3
        with:
          # ä½ çš„ HF Space çš„ IDï¼Œæ ¼å¼æ˜¯ `ç”¨æˆ¶å/Spaceå`
          space: "hang3976/hao"  # ğŸ‘ˆ æŠŠå®ƒæ›æˆä½ çš„ï¼
          
          # HF Tokenï¼Œå¾ GitHub Secrets ä¸­è®€å–æˆ‘å€‘å‰›å‰›è¨­ç½®çš„ HF_TOKEN
          token: ${{ secrets.HF_TOKEN }}
          
          # è¦éƒ¨ç½²çš„æœ¬åœ°æ–‡ä»¶å¤¾ï¼Œä¹Ÿå°±æ˜¯ Hugo ç”Ÿæˆçš„ public æ–‡ä»¶å¤¾
          source: "public"
          
          # éƒ¨ç½²åˆ° Space çš„å“ªå€‹æ–‡ä»¶å¤¾ï¼Œæ ¹ç›®éŒ„å°±æ˜¯ "."
          dest: "."
